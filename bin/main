#! /usr/bin/env node
const { program } = require("commander");
const chalk = require("chalk");
const figlet = require("figlet");
// è·å–createæ¨¡å—
const createModel = require("../lib/create");
// figlet å­—ä½“
const fonts = require("../assets/fonts");
const index = Math.floor(Math.random() * fonts.length);
const fontName = fonts[index].split(".")[0] || "Bloody";
console.log("ğŸ‘‡font-familyğŸ‘‰", fontName);

// figlet.js
let text = figlet.textSync("gornin", {
  // font: "Bloody",
  font: fontName,
  horizontalLayout: "default",
  verticalLayout: "default",
  width: 200,
  whitespaceBreak: true,
});
text = `\r\n${chalk.greenBright.bold(text)}\r\n`;
console.log(text);

// version
const version = require("../package.json").version;

program
  .name("gornin-starter") // é…ç½®è„šæ‰‹æ¶åç§°
  .usage("<command> [option]") // é…ç½®å‘½ä»¤æ ¼å¼ Usage
  .version(version, "-v, --version") // é…ç½®ç‰ˆæœ¬å· -v --version, ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¸åŠ 
  .option("-f, --foo", "useless, just test adding a option");

// è‡ªå®šä¹‰å¸®åŠ©
program.on("--help", () => {
  console.log();
  console.log(
    `Run ${chalk.blue(
      "gornin-starter <command> --help"
    )} for detailed usage of given command.`
  );
});

/*
.option('-n, --name <items1> [items2]', 'name description', 'default value')
è‡ªå®šä¹‰æ ‡å¿—<å¿…é¡»>ï¼šåˆ†ä¸ºé•¿çŸ­æ ‡è¯†ï¼Œä¸­é—´ç”¨é€—å·ã€ç«–çº¿æˆ–è€…ç©ºæ ¼åˆ†å‰²ï¼›æ ‡å¿—åé¢å¯è·Ÿå¿…é¡»å‚æ•°æˆ–å¯é€‰å‚æ•°ï¼Œå‰è€…ç”¨<>åŒ…å«ï¼Œåè€…ç”¨[]åŒ…å«
é€‰é¡¹æè¿°<çœç•¥ä¸æŠ¥é”™>ï¼šåœ¨ä½¿ç”¨ --help å‘½ä»¤æ—¶æ˜¾ç¤ºæ ‡å¿—æè¿°
é»˜è®¤å€¼<å¯çœç•¥>
çŸ­æ ‡å¿—å¯ä»¥ä½œä¸ºå•ç‹¬çš„å‚æ•°ä¼ é€’ã€‚åƒ -abc ç­‰äº -a -b -cã€‚å¤šè¯ç»„æˆçš„é€‰é¡¹ï¼Œåƒâ€œ--template-engineâ€ä¼šå˜æˆ program.templateEngine ç­‰ã€‚
*/
program
  .command("create <project-name>") // æ·»åŠ å‘½ä»¤åç§°
  .alias("c")
  .description("create a new project")
  .option("-f, --force", "overwrite target directory if exists") // ä½¿ç”¨.option()æ–¹æ³•å®šä¹‰commanderçš„é€‰é¡¹options
  .option("-u, --user <n>", "specifies the github user name")
  .action((projectName, options, cmd) => {
    // ä¸€ä¸ªå›è°ƒï¼Œå›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ä¸Šé¢çš„xxxï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯--åé¢çš„
    // å¼•å…¥createæ¨¡å—ï¼Œå¹¶ä¼ å…¥å‚æ•°
    createModel(projectName, options);
  });

/*
 * gornin-starter --help
 * gornin-starter -V
 */
program.parse(process.argv);
